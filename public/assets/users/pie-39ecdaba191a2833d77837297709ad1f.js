(function(){var t,n,e,r,a,o;r=[{svg:"svg#gender",json:"users/gender",category:function(t){return t.data.gender},text:function(t){return t.data.gender}},{svg:"svg#age",json:"users/age",category:function(t){return t.data.age},text:function(t){return t.data.age}}],o=$("div.col-md-6").width(),n=400,a=Math.min(o,n)/2,t=d3.svg.arc().outerRadius(.8*a).innerRadius(0),e=function(t){return d3.svg.arc().innerRadius(a*t).outerRadius(a*t)},r.forEach(function(r){var i,u,l;return i=d3.scale.category10(),u=d3.layout.pie().sort(null).value(function(t){return t.population}),l=d3.select(r.svg).attr("width",o).attr("height",n).append("g").attr("transform","translate("+o/2+","+n/2+")"),d3.json(r.json,function(n,o){var s,d,c;return c=d3.sum(o,function(t){return t.population}),o.forEach(function(t){return t.population=+t.population}),d=function(t){return t.startAngle+(t.endAngle-t.startAngle)/2},s=l.selectAll(".arc").data(u(o)).enter().append("g").attr("class","arc"),s.append("path").on("mouseover",function(){return d3.select(this).attr("opacity",.7)}).on("mouseout",function(){return d3.select(this).attr("opacity",1)}).attr("d",t).attr("stroke","white").style("fill",function(t){return i(r.category(t))}).transition().duration(1e3).attrTween("d",function(n){var e;return e=d3.interpolate({startAngle:0,endAngle:0},{startAngle:n.startAngle,endAngle:n.endAngle}),function(n){return t(e(n))}}),s.append("text").attr("transform",function(t){var n;return n=e(.9).centroid(t),d=t.startAngle+(t.endAngle-t.startAngle)/2,n[0]=.95*a*(d<Math.PI?1:-1),"translate("+n+")"}).attr("dy",".35em").style("text-anchor",function(t){return d=t.startAngle+(t.endAngle-t.startAngle)/2,d<Math.PI?"start":"end"}).transition().delay(1200).text(function(t){return r.text(t)}),s.append("text").attr("transform",function(n){return"translate("+t.centroid(n)+")"}).attr("dy",".35em").style("text-anchor","middle").style("fill","white").transition().delay(1100).text(function(t){var n;return n=Math.round(t.data.population/c*100),n>5?n+"%":void 0}),s.append("polyline").attr({opacity:.6,stroke:"black","stroke-width":2,fill:"none"}).transition().delay(1e3).duration(2e3).attr("points",function(t){var n,r;return n=d3.interpolate({startAngle:0,endAngle:0},{startAngle:t.startAngle,endAngle:t.endAngle}),r=e(.9).centroid(t),d=t.startAngle+(t.endAngle-t.startAngle)/2,r[0]=.95*a*(d<Math.PI?1:-1),[e(.8).centroid(t),e(.9).centroid(t),r]})})})}).call(this);